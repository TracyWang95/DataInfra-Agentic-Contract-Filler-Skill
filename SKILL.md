---
name: data-contract-skill
description: 多轮对话交互式填写国家数据局合同模板（支持4种合同类型），自动路由识别合同类型，生成清洁版 .docx 合同
---

# 国家数据局合同自动填写 Skill

## 概述

本 Skill 用于通过多轮自然语言对话，逐步收集用户提供的合同信息，填写国家数据局发布的4种示范合同模板，最终生成排版完整的 `.docx` 成品文件。

## 支持的合同类型

| 编号 | 合同名称 | 编码 | 当事人 |
|------|---------|------|-------|
| 1 | 数据提供合同 | GF-2025-2615 | 甲方（接收方）、乙方（提供方） |
| 2 | 数据委托处理服务合同 | GF-2025-2616 | 甲方（委托方）、乙方（受托方） |
| 3 | 数据融合开发合同 | GF-2025-2617 | 甲方（融合参与方1）、乙方（融合参与方2）、丙丁方（可选） |
| 4 | 数据中介服务合同 | GF-2025-2618 | 甲方（委托方）、乙方（中介方）、丙丁方（可选） |

## 核心流程

```
用户发起请求
    │
    ▼
┌─────────────────────────────────────┐
│ 1. 合同类型识别（自动路由）          │
│    关键词匹配识别合同类型            │
│    如无法识别则追问用户              │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ 2. 初始化：加载模板配置              │
│    python scripts/init_contract.py  │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ 3. 多轮对话收集信息                  │
│    按分组优先级逐轮提问              │
│    智能推断、别名联动                │
│    python scripts/update_state.py   │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ 4. 生成最终合同                      │
│    python scripts/fill_contract.py  │
└─────────────────────────────────────┘
```

## 第一步：识别合同类型

当用户发起请求时，首先识别合同类型：

### 自动识别规则

| 合同类型 | 识别关键词 |
|---------|-----------|
| 数据提供合同 | "数据提供"、"提供合同"、"卖数据"、"买数据"、"数据交易" |
| 数据委托处理服务合同 | "委托处理"、"数据处理"、"数据加工"、"数据清洗"、"数据标注" |
| 数据融合开发合同 | "融合开发"、"多方合作"、"数据融合"、"共同开发"、"联盟" |
| 数据中介服务合同 | "中介服务"、"撮合交易"、"交易平台"、"数据中介" |

### 如无法识别

提示用户选择：
```
我无法确定您需要哪种合同类型。请告诉我您的具体场景：

📋 支持的合同类型：

  1. **数据提供合同**（GF-2025-2615）
     适用于一方向另一方提供数据的交易场景
     
  2. **数据委托处理服务合同**（GF-2025-2616）
     适用于委托方将数据交给受托方进行处理的场景
     
  3. **数据融合开发合同**（GF-2025-2617）
     适用于多方共同参与数据融合开发的场景
     
  4. **数据中介服务合同**（GF-2025-2618）
     适用于中介方提供数据交易撮合服务的场景

请描述您的数据交易场景，或直接告诉我需要哪种合同。
```

## 第二步：初始化

识别出合同类型后，运行初始化脚本：

```bash
# 根据用户意图自动识别类型
python <skill_dir>/scripts/init_contract.py --intent "帮我填数据提供合同" --state "./contract_state.json"

# 或明确指定类型
python <skill_dir>/scripts/init_contract.py --type tigong --state "./contract_state.json"
```

类型参数：
- `tigong` - 数据提供合同
- `weituo` - 数据委托处理服务合同
- `ronghe` - 数据融合开发合同
- `zhongjie` - 数据中介服务合同

## 第三步：多轮对话收集信息

### 通用对话策略

1. **所有字段必填原则**（最重要！）：
   - 每个字段都必须填写，不能留空
   - 只有当用户**明确说**"暂时不填"、"跳过"、"不需要"时，才能将该字段标记为跳过
   - 如果用户没有提供某字段的值，必须**追问**直到获得答案
   - 生成合同前必须确认所有字段都已填写

2. **分批询问**：每轮只问一个大类，按优先级顺序
   - 必须等当前分组的**所有字段**都填写完毕后，才能进入下一个分组
   - 如果用户的回答不完整，继续追问该分组的剩余字段

3. **智能推断**：
   - 用户说"甲方是北京数据科技有限公司"→ 自动填充甲方名称、封面甲方、签署甲方
   - 用户给完整地址 → 推断签署城市
   - 用户说"合同总价50万"→ 推断金额 + 自动转大写"伍拾万元整"

4. **复选框处理**（重要！）：
   - 以 `☐` 开头的占位符是复选框，**必须明确选中或不选**
   - **选中状态**：值设为 `"☑"`、`"是"`、`"选中"` 
   - **不选状态**：值设为 `"☐"`、`"否"`、`"不选"`
   - 复选框也是必填的，必须询问用户选择哪个选项
   - 示例：`{"☐甲方_统一社会信用代码": "☑", "☐甲方_居民身份证": "☐"}`

5. **别名联动**：填写一个字段自动联动相关字段（如甲方名称→封面甲方名称→签署甲方）

### 更新状态

每轮对话后更新状态文件：

```bash
# 单个字段
python <skill_dir>/scripts/update_state.py --state "./contract_state.json" --field "甲方名称" --value "北京数据科技有限公司"

# 批量更新
python <skill_dir>/scripts/update_state.py --state "./contract_state.json" --json '{"甲方名称": "北京数据科技有限公司", "乙方名称": "上海智能技术有限公司"}'

# 查看进度
python <skill_dir>/scripts/update_state.py --state "./contract_state.json" --show
```

### 对话模板

每轮开始：
```
📋 {合同名称} 填写进度：已填 {filled}/{total} 项（{percentage}%）

接下来需要了解 **{当前分组名称}** 的信息：
{分组的ask提示}

请直接用自然语言描述，我会自动提取信息。
```

每轮结束（分组完成时）：
```
✅ 已提取以下信息：
  - 甲方名称：北京数据科技有限公司
  - 甲方证件类型：统一社会信用代码 ☑
  ...

📋 当前分组已全部填写完成！
还有 {remaining} 项未填写。继续下一部分。
```

每轮结束（分组未完成时，需要追问）：
```
✅ 已提取以下信息：
  - 甲方名称：北京数据科技有限公司
  ...

⚠️ 当前分组还有以下字段未填写：
  - 甲方_证件号码
  - 甲方_注册地址
  ...

请继续提供以上信息。
```

## 第四步：生成最终合同

```bash
python <skill_dir>/scripts/fill_contract.py --state "./contract_state.json" --output "./数据提供合同_成品.docx"
```

## 文件结构

```
data-contract-skill/
├── SKILL.md                    # 本文件
├── contracts/                  # 合同配置和模板
│   ├── __init__.py
│   ├── router.py               # 合同类型路由器
│   ├── base_config.py          # 共享配置和工具
│   ├── tigong/                 # 数据提供合同
│   │   ├── __init__.py
│   │   ├── config.py           # 占位符分组、别名
│   │   └── template.docx       # 模板文件
│   ├── weituo/                 # 数据委托处理服务合同
│   │   ├── ...
│   ├── ronghe/                 # 数据融合开发合同
│   │   ├── ...
│   └── zhongjie/               # 数据中介服务合同
│       ├── ...
├── scripts/
│   ├── init_contract.py        # 初始化（支持类型参数）
│   ├── update_state.py         # 更新状态
│   └── fill_contract.py        # 生成成品
└── examples/
    └── sample_state.json       # 示例状态文件
```

## 各合同占位符数量

| 合同类型 | 总占位符 | 分组数 |
|---------|---------|-------|
| 数据提供合同 | 189 | 14 |
| 数据委托处理服务合同 | 132 | 11 |
| 数据融合开发合同 | 219 | 16 |
| 数据中介服务合同 | 156 | 12 |

## 重要注意事项

1. **所有字段必填**：所有字段都必须填写，除非用户明确说"暂时不填"、"跳过"或"不需要"。包括：
   - 文本字段：必须有非空值
   - 复选框字段（☐开头）：必须明确选中（☑）或不选（☐），不能留空
2. **严格验证**：`fill_contract.py` 会检查所有字段，如有未填字段会拒绝生成（除非使用 `--force`）
3. **进度追踪**：每次更新后会显示剩余未填字段数量和下一步提示
4. **不要修改模板排版**：模板的页面设置、字体、字号、行距已调好，只替换 `{{}}` 内的内容
5. **同名信息联动**：利用别名规则自动填充相关字段
6. **依赖安装**：需要 `python-docx` 包：`pip install python-docx`

### 检查未填字段

```bash
# 仅检查，不生成文件
python <skill_dir>/scripts/fill_contract.py --state "./contract_state.json" --output "out.docx" --check

# 强制生成（未填字段留空）
python <skill_dir>/scripts/fill_contract.py --state "./contract_state.json" --output "out.docx" --force
```

## 示例对话

**用户**：帮我填一个数据提供合同

**AI**：
```
🔍 识别到合同类型：数据提供合同（GF-2025-2615）
✅ 合同初始化完成！

📋 数据提供合同 填写进度：已填 0/189 项（0%）

接下来需要了解 **合同基本信息** ：
请提供合同编号、签订日期（年月日）和签署地点（城市、区县）。
```

**用户**：合同编号是2025-DATA-001，2025年3月15日在北京市海淀区签

**AI**：
```
✅ 已提取以下信息：
  - 合同编号：2025-DATA-001
  - 签订日期：2025年3月15日
  - 签署地点：北京市海淀区

📋 填写进度：已填 6/189 项（3.2%）

接下来需要了解 **甲方信息**：
请提供甲方（接收方）的信息：公司名称、证件类型及号码、注册地址、法定代表人、联系人等。
```

...（继续多轮对话）...
